# C++项目：TinyMemoryPoll

## 项目介绍

本项目旨在实现一个高并发[内存池](https://so.csdn.net/so/search?q=内存池&spm=1001.2101.3001.7020)，参考了Google的开源项目[tcmalloc](https://github.com/google/tcmalloc)实现的简化版本。

TinyMemoryPoll的功能主要是实现高效的多线程内存管理。由功能可知，高并发指的是高效的多线程，而内存池则是实现内存管理的。



## 掌握知识

该项目要求读者掌握**C/C++**、**数据结构（链表和哈希桶）**、操作系统中的**内存管理**、**单例设计模式**、**多线程**以及**互斥锁**相关知识。

- **池化技术**

  **池化技术是指程序预先向系统申请过量的资源，并对这些资源进行合理管理，避免需要使用频繁的申请和释放资源导致的开销。**

  常见的池化技术应用还有**数据结构池**、**线程池**、**对象池**、**连接池**等，读者可自行了解。

- **内存池**

  内存池指的是程序预先向操作系统申请足够大的一块内存空间；此后，程序中需要申请内存时，不需要直接向操作系统申请，而是直接从内存池中获取进行使用；同理，程序释放内存时，也不是将内存直接还给操作系统，而是将内存归还给内存池，以备下次被程序申请使用。当程序退出（或者特定时间）时，内存池才将之前申请内存池中的全部内存真正释放。

- **内存池主要解决问题**

  内存池主要解决的是**频繁的内存分配和释放操作所导致的效率问题和内存碎片(不了解的可以参考[浅谈内存碎片](https://blog.csdn.net/fdk_lcl/article/details/89482835))问题**。传统的内存分配方式每次都需要向操作系统申请一块内存，而释放内存时也需要向操作系统归还内存。这种方式存在以下问题：

  1. **内存分配和释放操作的开销比较大**，需要耗费一定的时间和资源，会影响程序的性能；
  2. 由于内存分配和释放不可控，可能会导致**内存碎片**问题，降低内存的使用效率；
  3. **内存泄漏**问题，由于程序无法确定何时需要释放内存，可能导致内存泄漏和资源浪费问题。

​	内存池通过预先分配一块内存池，并且把内存池分成多个大小相等的内存块，每次从内存池中取	出内存块使用，使用完后再归还给内存池，这样就可以避免了频繁的内存分配和释放操作。同	时，内存池还可以提高内存的使用效率，避免内存碎片问题的发生，而且还可以避免内存泄漏问	题。

- **malloc解析**

  实际上，malloc函数属于C语言的库函数，并非是系统调用。当我们使用malloc函数动态申请内存时，malloc函数会根据程序申请的内存大小（一般以128k为分界线）选择调用brk()系统调用在堆区申请内存或者mmap()系统调用在文件映射区申请内存。偷一下懒，这里放一下[小林coding](https://xiaolincoding.com/)的示意图：

​	![img](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/brk%E7%94%B3%E8%AF%B7.png)

![img](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/brk%E7%94%B3%E8%AF%B7.png)
